<?xml version="1.0" encoding="utf-8"?>
<!--Setting locale for MEXICO-->
<#setting locale = "es_MX">
<!--Certification date-->
<#assign aDateTime = .now>
<!--Zeros number-->
<#assign zeros = "0.00">
<#assign customItem = customData.extraData.customItem>
<#assign customRecordData = customData.extraData.customRecordData>
<#function getAttrPair attr value1 value2>
   <#if value1?has_content>
    <#assign result="${attr}=\"${value1}\"">
    <#return result>
  <#else>
	<#assign result="${attr}=\"${value2}\"">
    <#return result>
  </#if>  
</#function>
<#function getNodePair node attr value>
   <#if value?has_content>
    <#assign result="<${node} ${attr}=\"${value}\" />">
    <#return result>
  </#if>  
</#function>
<!--Transform a string from $0,0.00 to 0.00-->
<#function formatFromCurrency amount>
	<#assign result = amount?keep_after("$")?replace(",", "")?number?string[zeros]>
	<#return result>
</#function>
<#function formatFromString amount>
	<#assign result = amount?number?string[zeros]>
	<#return result>
</#function>
<#function formatRate amount>
	<#assign result = ((amount?number)/100)?string[zeros]>
	<#return result>
</#function>
<cfdi:Comprobante 
    xsi:schemaLocation="http://www.sat.gob.mx/cfd/4 http://www.sat.gob.mx/sitio_internet/cfd/4/cfdv40.xsd http://www.sat.gob.mx/Pagos20 http://www.sat.gob.mx/sitio_internet/cfd/Pagos/Pagos20.xsd" 
    xmlns:pago20="http://www.sat.gob.mx/Pagos20" 
    xmlns:cfdi="http://www.sat.gob.mx/cfd/4" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    Version="4.0" 
    Serie="${customRecordData.serie}" 
	Folio="${customRecordData.folio}" 
    Fecha="${aDateTime?string.iso_nz?keep_before(".")}" 
    SubTotal="0" 
    Moneda="XXX" 
    Total="0.00" 
    TipoDeComprobante="P" 
    Exportacion="${record.custbody_ent_entloc_exportacion?keep_before(" -")}"
    LugarExpedicion="${customData.extraData.customSubsidiaryData.address.zip}"
>
    <#if customRecordData.relatedCfdis?has_content>
		<#list customRecordData.relatedCfdis as relatedCfdi>
			<cfdi:CfdiRelacionados TipoRelacion="${relatedCfdi.tipoRelacion?keep_before(" -")}">
				<#list relatedCfdi.transacciones as transaccion>
					<cfdi:CfdiRelacionado UUID="${transaccion.uuid}"/>
				</#list>
			</cfdi:CfdiRelacionados>
		</#list>
	</#if>
	<cfdi:Emisor 
        Rfc="${subsidiary.federalidnumber}" 
        Nombre="${subsidiary.name}" 
		RegimenFiscal="${subsidiary.custrecord_ent_entloc_regimen_fiscal?keep_before(" -")}"
    />
	<cfdi:Receptor 
		Rfc="${customer.custentity_ent_entloc_rfc}" 
		Nombre="${customer.firstname} ${customer.middlename} ${customer.lastname}" 
		DomicilioFiscalReceptor="${customer.billzip}" 
		RegimenFiscalReceptor="${record.custbody_ent_entloc_reg_fis_receptor?keep_before(" -")}" 
		UsoCFDI="${record.custbody_ent_entloc_uso_cfdi?keep_before(" -")}"
	/> 
	<cfdi:Conceptos>
        <cfdi:Concepto ClaveProdServ="84111506" Cantidad="1" ClaveUnidad="ACT" Descripcion="Pago" ValorUnitario="0" Importe="0" ObjetoImp="01" />
    </cfdi:Conceptos>
	<cfdi:Complemento>
		<pago20:Pagos Version="2.0">
			<pago20:Totales MontoTotalPagos="${formatFromCurrency(record.payment)}"/>
			<pago20:Pago 
				FechaPago="${record.createddate?string.iso_nz}" 
				FormaDePagoP="${record.custbody_ent_entloc_forma_pago?keep_before(" -")}" 
				MonedaP="${record.currencysymbol}" 
				Monto="${formatFromCurrency(record.payment)}" 
				TipoCambioP="1"
			>
				<pago20:DoctoRelacionado 
					IdDocumento="bfc36522-4b8e-45c4-8f14-d11b289f9eb7" 
					MonedaDR="MXN" 
					NumParcialidad="1" 
					ImpSaldoAnt="Importe a pagar" 
					ImpPagado="Pago" 
					ImpSaldoInsoluto="ImpSaldoAnt - ImpPagado" 
					ObjetoImpDR="02" 
					EquivalenciaDR="1"
				>
					<pago20:ImpuestosDR>
                        <pago20:TrasladosDR>
                            <pago20:TrasladoDR BaseDR="100.00" ImpuestoDR="002" TipoFactorDR="Tasa" TasaOCuotaDR="0.160000" ImporteDR="16.00" />
                        </pago20:TrasladosDR>
                    </pago20:ImpuestosDR>
				</pago20:DoctoRelacionado>
			</pago20:Pago>
		</pago20:Pagos>
	</cfdi:Complemento>
</cfdi:Comprobante>